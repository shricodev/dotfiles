---
- name: Set up the system
  become: true
  hosts: all

  pre_tasks:
    - name: Detect dotfiles user
      ansible.builtin.import_tasks: pre_tasks/detect_host_user.yml
      tags:
        - always

    - name: Update package cache
      ansible.builtin.import_tasks: pre_tasks/update_package_cache.yml
      tags:
        - always

    - name: Setup ansible user
      ansible.builtin.import_tasks: pre_tasks/setup_ansible_user.yml
      tags:
        - always

    - name: Create '.config' directory
      ansible.builtin.import_tasks: pre_tasks/create_config_directory.yml
      tags:
        - always

    - name: Setup SSH
      ansible.builtin.import_tasks: pre_tasks/setup_ssh.yml
      # There's no need to setup SSH on localhost.
      # so for that I've introduced this variable.
      when: needs_ssh_setup | bool

  # roles:
  #   - common
